define("warmup/bi/events.json",[],function(){return{SERVER_SIDE_RENDERING_FLOW:{eventId:380,adapter:"ugc-viewer",sampleRatio:1,params:{phase_name:"phase",status:"status",warning_msg:"warningMessage",isBot:"isBot"}}}}),define("warmup/bi/events",["warmup/bi/events.json","lodash","loggingUtils"],function(e,t,n){"use strict";return n.logger.register("warmup","event",e),e}),define("warmup/lib/bodyStub",[],function(){"use strict";return{generate:function(){var e=window.document.createElement("DIV");e.setAttribute("id","SITE_CONTAINER"),window.document.body.appendChild(e),window.clientSideRender=!0,window.santaRenderingError={errorInfo:"body failed to render"}}}}),define("warmup/lib/layout",["lodash","coreUtils","siteUtils","layout"],function(e,t,n,r){"use strict";function i(t,r){if(!r)return e.forOwn(t.notRenderedStructures,function(e,t){"undefined"!==t&&(e.getDomNodeFunc=a)});var i={};return i.inner=n.structuresDescription.getInner(t,a),i.outer=n.structuresDescription.getOuter(t,a),i.siteBackground=n.structuresDescription.getSiteBackground(t,a),i.wixAds=n.structuresDescription.getWixAds(t),i}function a(){var t=e.toArray(arguments),n=t.join(""),r=window.document.getElementById(n);if(!r){var i=t[0],a=t.slice(1).map(function(e){return e.replace(i,"")}).join("");r=window.document.getElementById(i+a)}return r}return{runLayout:function(n,o){o=o||e.noop;var s=n.getRootNavigationInfo(),u=s.pageId,d=e.isEmpty(n.notRenderedStructures),c=i(n,d),l={getSiteData:function(){return n},getAllRenderedRootIds:function(){return["masterPage",u]},getRuntimeDal:function(){return{getCompData:function(){return null},getCompDesign:function(){return null},getCompProps:function(){return null},getActionsAndBehaviors:function(){return null}}}};r.reLayout(c,l),t.mobileViewportFixer.fixViewportTag(n),r.updateBodyNodeStyle(n),d&&(a("masterPage").style.visibility="",a(s.pageId).style.visibility=""),o()}}}),define("warmup/lib/anchorLinkHandler",["lodash","zepto","coreUtils"],function(e,t,n){"use strict";var r=n.siteConstants.PAGE_ANCHORS,i="data-originalHref";return{patchAnchorLinks:function(n,a){var o={};e.set(o,r.TOP_ANCHOR_ID,"prepend"),e.set(o,r.BOTTOM_ANCHOR_ID,"append"),e.forEach(o,function(e,n){if(0===window.document.querySelectorAll(n).length){var r=window.document.createElement("A");r.setAttribute("id",n),t(window.document.body)[e](r)}}),t("a[data-anchor]").each(function(t,r){var o=r.getAttribute("data-anchor"),s=e.get(n.getDataByQuery(o),"compId",o);if(!e.includes(r.href,"#")&&r.href===a){var u=r.getAttribute("href");r.setAttribute(i,u),r.setAttribute("href","#"+s)}})},restoreAnchorLinks:function(){t("a[data-originalHref]").each(function(e,t){var n=t.getAttribute(i);t.setAttribute("href",n),t.removeAttribute(i)})}}}),define("warmup/lib/indicator",[],function(){"use strict";function e(){var e=window.document.createElement("style");e.appendChild(window.document.createTextNode("")),window.document.body.appendChild(e),e.sheet.insertRule("#warmup-indicator { padding: 6px; font-size: 12px; position: fixed; bottom: 0; left: 0; z-index: 2147483647; border: 2px solid black; text-align: center; border-radius: 4px; text-transform: capitalize; background-color: yellow; }",0),e.sheet.insertRule("#warmup-indicator.layout { background-color: orange; }",0),e.sheet.insertRule("#warmup-indicator.success { background-color: green; }",0),e.sheet.insertRule("#warmup-indicator.fail { background-color: red; }",0),e.sheet.insertRule("#warmup-indicator.standby { background-color: cyan; }",0),e.sheet.insertRule("#warmup-indicator.rendering { background-color: white; }",0)}function t(e){(r=window.document.createElement("div")).setAttribute("id","warmup-indicator"),r.addEventListener("click",e),window.document.body.appendChild(r)}function n(e){r&&(r.innerHTML=e,r.setAttribute("class",e))}var r=void 0,i={INITIAL:"initial",WARMUP:"warmup",SUCCESS:"success",FAIL:"fail",RENDERING:"rendering",STANDBY:"standby"};return{init:function(r){e(),t(r),n(i.INITIAL)},updateState:n,STATES:i}}),define("warmup/lib/iframesHandler",["zepto","lodash"],function(e,t){"use strict";function n(){a.forEach(function(e){e.ref.removeEventListener("load",i)})}function r(){return e("iframe[data-src]")}function i(e){var n=t.filter(a,{ref:this})[0];n.isLoaded=!0,n.event=e}var a=[];return{registerIframesOnLoad:function(){r().forEach(function(e){a.push({ref:e,isLoaded:!1}),e.addEventListener("load",i,!1)})},flushEvents:function(){n(),t(a).filter(function(e){return e.isLoaded&&"function"==typeof e.ref.onload}).forEach(function(e){e.ref.onload(e.event)}),a=null}}}),define("warmup/lib/postMessageHandler",["lodash"],function(e){"use strict";function t(){window.removeEventListener("message",n)}function n(e){r.push(e)}var r=[];return{registerToPostMessages:function(){window.addEventListener("message",n,!1)},flushPostMessages:function(){t(),e.forEach(r,function(e){window.dispatchEvent(e)}),r=null}}}),define("warmup",["lodash","zepto","experiment","coreUtils","loggingUtils","siteUtils","warmup/bi/events","warmup/lib/bodyStub","warmup/lib/layout","warmup/lib/anchorLinkHandler","warmup/lib/indicator","warmup/lib/iframesHandler","warmup/lib/postMessageHandler"],function(e,t,n,r,i,a,o,s,u,d,c,l,w){"use strict";function p(t,n,r,a){var s=t.publicModel.deviceInfo,u="Bot"===e.get(s,"browserType");i.logger.reportBI(t,o.SERVER_SIDE_RENDERING_FLOW,{phase:n,status:e.defaultTo(r,!0)?1:0,warningMessage:a||null,isBot:u})}function f(t,n){var r=new a.SiteData(e.assign({},t,{pagesData:n.displayedPagesData,notRenderedStructures:n.notRenderedStructures}));return delete r.resolvedDataMaps,r.anchorsMap=n.anchorsMap,r.imagesToLayout=n.imagesToLayout,r}return{init:function(a,o){p(a,"did_load_warmup_packages"),t(function(){var g=!e.isUndefined(window.clientSideRender);if(p(a,"will_warmup",g,g?null:"Body not rendered"),g||(window.clientSideRender=!0,s.generate(a)),window.clientSideRender)return p(a,"did_warmup",g,e.get(window,"santaRenderingError.reason","Fallback to client")),void o();var m=window.warmupData.landingPageNavigationInfo;e.assign(a,e.pick(window.warmupData,["svgShapes","wixapps","mediaRichTextInnerComponents","browserDetection","externalStyles","runtime","afterSSRWithWixCode","landingPageNavigationInfo","dynamicPages","pendingBehaviours","clonedDataItemsIdsMap"]),{pagesData:window.warmupData.fullPagesData}),t("body").addClass("warmup");var v=f(a,window.warmupData);v.setRootNavigationInfo(m),v.updateScreenSize(),window.pagesData=window.pagesData||window.warmupData&&window.warmupData.fullPagesData,r.urlUtils.setPersistentCacheKiller(window.warmupData.persistentCacheKiller);var h=window.document.getElementById("SITE_CONTAINER").children[0];window.sssr.serverSantaVersion=h.getAttribute("data-santa-version"),window.sssr.serverMarkup=h.innerHTML,r.urlUtils.isTrue("ssrindicator")&&c.init(function(){!1===window.sssr.success&&window.open("https://santatools.wix.com/diverginator/?vsi="+window.wixBiSession.viewerSessionId),r.urlUtils.isTrue("ssrWarmupOnly")&&(c.updateState(c.STATES.RENDERING),o())}),w.registerToPostMessages(),l.registerIframesOnLoad(),t("#SITE_ROOT").css({"min-height":"100%",position:"relative",margin:"0 auto"}),u.runLayout(v,function(){if(c.updateState(c.STATES.WARMUP),d.patchAnchorLinks(v,location.href),i.logger.reportBeatEvent(v,"visible",m.pageId),n.isOpen("sv_ssrEmitLoadEvent",v)){var e=window.document.createEvent("Event");e.initEvent("load",!1,!1),window.dispatchEvent(e)}p(v,"did_warmup"),r.urlUtils.isTrue("ssrWarmupOnly")||n.isOpen("sv_ssrWarmupOnly",v)?c.updateState(c.STATES.STANDBY):o()})})},willRender:function(e){p(e,"will_render")},didRender:function(n,r){t("body").removeClass("warmup"),e.forEach(n.runtime.components,function(t){e.unset(t,"overrides.actionsBehaviors")}),r&&(l.flushEvents(),w.flushPostMessages(),d.restoreAnchorLinks()),c.updateState(r?c.STATES.SUCCESS:c.STATES.FAIL),p(n,"did_render",r)}}});
//# sourceMappingURL=warmup.min.js.map